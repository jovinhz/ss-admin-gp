"use strict";(self["webpackChunksumatera_soil"]=self["webpackChunksumatera_soil"]||[]).push([[486],{7486:function(e,t,a){a.r(t),a.d(t,{default:function(){return M}});var s=a(3396),i=a(7139);const l={class:"content-title"},n=(0,s._)("h5",null,"Daftar Approval Petani",-1),o=["disabled"],r=(0,s._)("i",{class:"fe fe-refresh-cw mr-1"},null,-1),d=(0,s.Uk)(" Refresh "),u=[r,d],c=(0,s.Uk)("Semua"),m=(0,s.Uk)("Pending"),f=(0,s.Uk)("Diterima"),h=(0,s.Uk)("Ditolak"),k={key:0},_=["onClick"],p=(0,s._)("i",{class:"fe fe-x"},null,-1),g=[p],w=["onClick"],b=(0,s._)("i",{class:"fe fe-check"},null,-1),v=[b],j={class:"row"},y={class:"col-12"},R=(0,s._)("button",{type:"submit",class:"d-none"},null,-1);function D(e,t,a,r,d,p){const b=(0,s.up)("a-select-option"),D=(0,s.up)("a-select"),S=(0,s.up)("a-tag"),x=(0,s.up)("a-table"),C=(0,s.up)("a-textarea"),F=(0,s.up)("a-form-item"),U=(0,s.up)("a-form"),W=(0,s.up)("a-modal");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",l,[n,(0,s._)("div",null,[(0,s._)("button",{class:"btn btn-light mr-3",onClick:t[0]||(t[0]=(...t)=>e.refresh&&e.refresh(...t)),disabled:e.loading},u,8,o),(0,s.Wm)(D,{ref:"select",value:e.filterStatus,"onUpdate:value":t[1]||(t[1]=t=>e.filterStatus=t),style:{width:"120px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{value:"all"},{default:(0,s.w5)((()=>[c])),_:1}),(0,s.Wm)(b,{value:"pending"},{default:(0,s.w5)((()=>[m])),_:1}),(0,s.Wm)(b,{value:"accepted"},{default:(0,s.w5)((()=>[f])),_:1}),(0,s.Wm)(b,{value:"rejected"},{default:(0,s.w5)((()=>[h])),_:1})])),_:1},8,["value"])])]),(0,s._)("div",null,[(0,s.Wm)(x,{columns:e.columns,"data-source":e.filteredRowData,"row-key":e=>e.id,loading:e.loading,scroll:{y:e.setting.maxTableContentHeight,x:!0}},{bodyCell:(0,s.w5)((({column:t,text:a})=>["action"===t.key?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[1===a.status_id?((0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("button",{class:"btn btn-danger btn-sm mr-3",onClick:t=>e.openRejectFormModal(a)},g,8,_),(0,s._)("button",{class:"btn btn-success btn-sm",onClick:t=>e.navigateToCreateFarmer(a)},v,8,w)])):(0,s.kq)("",!0)],64)):(0,s.kq)("",!0),"status"===t.key?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[1===a.status_id?((0,s.wg)(),(0,s.j4)(S,{key:0,color:"orange"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(a.status_caption),1)])),_:2},1024)):(0,s.kq)("",!0),2===a.status_id?((0,s.wg)(),(0,s.j4)(S,{key:1,color:"green"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(a.status_caption),1)])),_:2},1024)):(0,s.kq)("",!0),3===a.status_id?((0,s.wg)(),(0,s.j4)(S,{key:2,color:"red"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(a.status_caption),1)])),_:2},1024)):(0,s.kq)("",!0)],64)):(0,s.kq)("",!0)])),_:1},8,["columns","data-source","row-key","loading","scroll"])]),(0,s.Wm)(W,{class:"form-modal",visible:e.rejectModalVisible,"onUpdate:visible":t[3]||(t[3]=t=>e.rejectModalVisible=t),title:"Alasan Reject",confirmLoading:e.loadingReject,onOk:e.handleReject},{default:(0,s.w5)((()=>[(0,s.Wm)(U,{layout:"vertical",ref:"formRef",model:e.formState,rules:e.formRules,onFinish:e.handleReject},{default:(0,s.w5)((()=>[(0,s._)("div",j,[(0,s._)("div",y,[(0,s.Wm)(F,{ref:"reason",name:"reason"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{value:e.formState.rejected_reason,"onUpdate:value":t[2]||(t[2]=t=>e.formState.rejected_reason=t),placeholder:"Alasan penolakan"},null,8,["value"])])),_:1},512)])]),R])),_:1},8,["model","rules","onFinish"])])),_:1},8,["visible","confirmLoading","onOk"])])}var S=a(4870),x=a(7417),C=a(9145);const F=new C.Z,U=e=>F.withOptions({showProgressBar:!1}).axiosInstance.get("/administrator/be_farmers",{params:e}),W=(e,t)=>F.withOptions({successFeedbackMessage:"Petani berhasil ditolak",showSuccessFeedback:!0}).axiosInstance.put(`/administrator/be_farmers/${e}`,{rejected_reason:t});var A=a(7182),q=(0,s.aZ)({name:"FarmerApprovals",setup(){const e=(0,x.oR)(),t=(0,s.Fl)((()=>e.getters["Setting/settings"])),a=(0,S.iH)(!1),i=e=>{a.value=!0,l.value=e},l=(0,S.iH)(),n=(0,S.iH)("all"),o=(0,S.iH)([{title:"Nama",key:"name",dataIndex:"name"},{title:"No Telp",key:"phone_number",dataIndex:"phone_number"},{title:"Alamat",key:"address",dataIndex:"address",maxWidth:100},{title:"Latitude",key:"latitude",dataIndex:"latitude"},{title:"Longitude",key:"longitude",dataIndex:"longitude"},{title:"Status",key:"status"},{title:"Alasan Penolakan",key:"rejected_reason",dataIndex:"rejected_reason",width:200},{title:"Action",key:"action",width:130}]),r=(0,S.iH)(),d=(0,S.qj)({rejected_reason:void 0}),u={rejected_reason:[{required:!0,trigger:"change",message:"Alasan penolakan tidak boleh kosong"}]};return{columns:o,setting:t,formRules:u,formRef:r,formState:d,rejectModalVisible:a,focusedApproval:l,filterStatus:n,openRejectFormModal:i}},data(){return{rowData:[],loading:!0,loadingReject:!1}},computed:{filteredRowData(){return this.rowData.filter((e=>"all"===this.filterStatus||("pending"===this.filterStatus?1===e.status_id:"accepted"===this.filterStatus?2===e.status_id:"rejected"!==this.filterStatus||3===e.status_id)))}},mounted(){this.fetchData()},methods:{async fetchData(){this.loading=!0;const e=await U({limit:1e6});e.success&&(this.rowData=e.data.data),this.loading=!1},refresh(){this.rowData=[],this.fetchData()},async doReject(){this.$nprogress.start(),this.loadingReject=!0;const e=await W(this.focusedApproval.id,this.formState.rejected_reason);e.success&&(this.formRef.resetFields(),this.rejectModalVisible=!1,this.refresh()),this.$nprogress.done(),this.loadingReject=!1},handleReject(){this.formRef.validate().then((()=>this.doReject())).catch((()=>{}))},navigateToCreateFarmer(e){this.$router.push({name:A.Z.CreateFarmer.name,params:{be_farmer_id:e.id,address:e.address,latitude:e.latitude,longitude:e.longitude,name:e.name,phone_number:e.phone_number}})}}}),H=a(89);const I=(0,H.Z)(q,[["render",D]]);var M=I}}]);