"use strict";(self["webpackChunksumatera_soil"]=self["webpackChunksumatera_soil"]||[]).push([[942],{9942:function(e,t,a){a.r(t),a.d(t,{default:function(){return ie}});var i=a(3396),s=a(7139);const n={class:"content-title"},l=(0,i._)("h5",null,"Daftar Transaksi QC - Customer",-1),r=["disabled"],o=(0,i._)("i",{class:"fe fe-refresh-cw mr-1"},null,-1),c=(0,i.Uk)(" Refresh "),u=[o,c],m=(0,i.Uk)("Semua"),d=(0,i.Uk)("Menunggu untuk dijemput"),_=(0,i.Uk)("Sedang diantar ke Customer"),f=(0,i.Uk)("Menunggu pembayaran"),h=(0,i.Uk)("Selesai"),k=(0,i.Uk)("Dibatalkan"),y={key:0,class:"d-flex"},p=["src"],w=(0,i._)("span",{class:"d-inline-block",style:{color:"#888",width:"80px"}}," Komoditi ",-1),g=(0,i._)("span",{class:"mx-2"},":",-1),v=(0,i._)("span",{class:"d-inline-block",style:{color:"#888",width:"80px"}}," Qty Pick-up ",-1),b=(0,i._)("span",{class:"mx-2"},":",-1),D=(0,i._)("span",{class:"d-inline-block",style:{color:"#888",width:"80px"}}," Qty Delivery ",-1),C=(0,i._)("span",{class:"mx-2"},":",-1),x=(0,i._)("span",{class:"d-inline-block",style:{color:"#888",width:"80px"}}," Harga ",-1),q=(0,i._)("span",{class:"mx-2"},":",-1),S={key:1,class:"d-flex"},F=["onClick"],U=(0,i._)("i",{class:"fe fe-check mr-2"},null,-1),W=(0,i._)("span",null,"Konfirmasi Delivery",-1),z=[U,W],R=["onClick"],H=(0,i._)("i",{class:"fe fe-check mr-2"},null,-1),I=(0,i._)("span",null,"Konfirmasi Pembayaran",-1),T=[H,I],B=["onClick"],K=(0,i._)("i",{class:"fe fe-x mr-2"},null,-1),P=(0,i._)("span",null,"Batalkan",-1),j=[K,P],M={class:"row"},O={class:"col-12"},N={class:"col-12"},$=(0,i._)("button",{type:"submit",class:"d-none"},null,-1);function Q(e,t,a,o,c,U){const W=(0,i.up)("a-select-option"),H=(0,i.up)("a-select"),I=(0,i.up)("a-tag"),K=(0,i.up)("a-table"),P=(0,i.up)("a-input"),Q=(0,i.up)("a-form-item"),V=(0,i.up)("a-input-number"),Z=(0,i.up)("a-form"),A=(0,i.up)("a-modal");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",n,[l,(0,i._)("div",null,[(0,i._)("button",{class:"btn btn-light mr-3",onClick:t[0]||(t[0]=(...t)=>e.refresh&&e.refresh(...t)),disabled:e.loading},u,8,r),(0,i.Wm)(H,{ref:"select",value:e.filterStatus,"onUpdate:value":t[1]||(t[1]=t=>e.filterStatus=t),style:{width:"220px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{value:"all"},{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)(W,{value:"wait"},{default:(0,i.w5)((()=>[d])),_:1}),(0,i.Wm)(W,{value:"delivery"},{default:(0,i.w5)((()=>[_])),_:1}),(0,i.Wm)(W,{value:"payment"},{default:(0,i.w5)((()=>[f])),_:1}),(0,i.Wm)(W,{value:"done"},{default:(0,i.w5)((()=>[h])),_:1}),(0,i.Wm)(W,{value:"canceled"},{default:(0,i.w5)((()=>[k])),_:1})])),_:1},8,["value"])])]),(0,i._)("div",null,[(0,i.Wm)(K,{columns:e.columns,"data-source":e.filteredRowData,"row-key":e=>e.id,loading:e.loading,scroll:{y:e.setting.maxTableContentHeight,x:2e3}},{bodyCell:(0,i.w5)((({column:t,text:a})=>["commodity"===t.key?((0,i.wg)(),(0,i.iD)("div",y,[(0,i._)("img",{src:a.items[0].image_when_pick_up_url,alt:"",style:{width:"60px",height:"60px","margin-right":"20px"}},null,8,p),(0,i._)("div",null,[(0,i._)("div",null,[w,g,(0,i._)("span",null,(0,s.zw)(a.items[0].product.name),1)]),(0,i._)("div",null,[v,b,(0,i._)("span",null,(0,s.zw)(a.items[0].qty_when_pick_up)+" "+(0,s.zw)(a.items[0].product.unit),1)]),(0,i._)("div",null,[D,C,(0,i._)("span",null,(0,s.zw)(a.items[0].qty_after_delivery??"-")+" "+(0,s.zw)(a.items[0].product.unit),1)]),(0,i._)("div",null,[x,q,(0,i._)("span",null,(0,s.zw)(a.items[0].formatted_price),1)])])])):(0,i.kq)("",!0),"action"===t.key?((0,i.wg)(),(0,i.iD)("div",S,[2===a.status_id?((0,i.wg)(),(0,i.iD)("button",{key:0,class:"btn btn-success btn-sm mr-3",onClick:t=>e.openConfirmDeliveryModal(a)},z,8,F)):(0,i.kq)("",!0),3===a.status_id?((0,i.wg)(),(0,i.iD)("button",{key:1,class:"btn btn-success btn-sm mr-3",onClick:t=>e.doConfirmPayment(a)},T,8,R)):(0,i.kq)("",!0),5!==a.status_id&&4!==a.status_id?((0,i.wg)(),(0,i.iD)("button",{key:2,class:"btn btn-danger btn-sm mr-3",onClick:t=>e.handleCancel(a.id)},j,8,B)):(0,i.kq)("",!0)])):(0,i.kq)("",!0),"status"===t.key?((0,i.wg)(),(0,i.iD)(i.HY,{key:2},[1===a.status_id?((0,i.wg)(),(0,i.j4)(I,{key:0,color:"orange"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.status_caption),1)])),_:2},1024)):(0,i.kq)("",!0),2===a.status_id?((0,i.wg)(),(0,i.j4)(I,{key:1,color:"orange"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.status_caption),1)])),_:2},1024)):(0,i.kq)("",!0),3===a.status_id?((0,i.wg)(),(0,i.j4)(I,{key:2,color:"orange"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.status_caption),1)])),_:2},1024)):(0,i.kq)("",!0),4===a.status_id?((0,i.wg)(),(0,i.j4)(I,{key:3,color:"green"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.status_caption),1)])),_:2},1024)):(0,i.kq)("",!0),5===a.status_id?((0,i.wg)(),(0,i.j4)(I,{key:4,color:"red"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.status_caption),1)])),_:2},1024)):(0,i.kq)("",!0)],64)):(0,i.kq)("",!0)])),_:1},8,["columns","data-source","row-key","loading","scroll"])]),(0,i.Wm)(A,{class:"form-modal",visible:e.confirmDeliveryVisible,"onUpdate:visible":t[4]||(t[4]=t=>e.confirmDeliveryVisible=t),title:"Konfirmasi Delivery",confirmLoading:e.loadingConfirm,onOk:e.handleConfirmDelivery},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{layout:"vertical",ref:"confirmDeliveryFormRef",model:e.confirmDeliveryFormState,rules:e.confirmDeliveryRules,onFinish:e.handleConfirmDelivery},{default:(0,i.w5)((()=>[(0,i._)("div",M,[(0,i._)("div",O,[(0,i.Wm)(Q,{label:"Nama Customer",ref:"customer_name",name:"customer_name"},{default:(0,i.w5)((()=>[(0,i.Wm)(P,{placeholder:"Nama customer",value:e.confirmDeliveryFormState.customer_name,"onUpdate:value":t[2]||(t[2]=t=>e.confirmDeliveryFormState.customer_name=t)},null,8,["value"])])),_:1},512)]),(0,i._)("div",N,[(0,i.Wm)(Q,{label:"Berat Barang Ketika Sampai",ref:"qty",name:"qty"},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{placeholder:"Berat",value:e.confirmDeliveryFormState.qty,"onUpdate:value":t[3]||(t[3]=t=>e.confirmDeliveryFormState.qty=t)},null,8,["value"])])),_:1},512)])]),$])),_:1},8,["model","rules","onFinish"])])),_:1},8,["visible","confirmLoading","onOk"])])}var V=a(4870),Z=a(2574),A=a(7417),L=a(9145);const E=new L.Z,Y=e=>E.withOptions({showProgressBar:!1}).axiosInstance.get("/administrator/warehouse_transactions",{params:e}),G=(e,t)=>E.withOptions({successFeedbackMessage:"Konfirmasi berhasil",showSuccessFeedback:!0}).axiosInstance.put(`/administrator/warehouse_transactions/${e}/confirm_delivery`,t),J=e=>E.withOptions({successFeedbackMessage:"Konfirmasi pembayaran berhasil",showSuccessFeedback:!0,showProgressBar:!0}).axiosInstance.put(`/administrator/warehouse_transactions/${e}/confirm_payment`),X=e=>E.withOptions({successFeedbackMessage:"Transaksi berhasil dibatalkan",showSuccessFeedback:!0}).axiosInstance.put(`/administrator/warehouse_transactions/${e}/cancel`);var ee=(0,i.aZ)({name:"Transaction",setup(){const e=(0,A.oR)(),t=(0,i.Fl)((()=>e.getters["Setting/settings"])),a=(0,V.iH)(!1),s=e=>{a.value=!0,n.value=e},n=(0,V.iH)(),l=(0,V.iH)("all"),r=(0,V.iH)([{title:"Nama Customer",key:"customer_name",dataIndex:"customer_name",width:120},{title:"Nama QC",key:"qc_name",dataIndex:["warehouse","name"]},{title:"Barang",key:"commodity",width:400},{title:"Status",key:"status"},{title:"Tanggal Request Pickup",key:"request_pick_up_at_caption",dataIndex:"request_pick_up_at_caption"},{title:"No Plat",key:"truck_identity_number",dataIndex:"truck_identity_number"},{title:"Estimasi Total Harga",key:"formatted_estimated_total_price",dataIndex:"formatted_estimated_total_price"},{title:"Total Harga",key:"formatted_total_price",dataIndex:"formatted_total_price",width:100},{title:"Action",key:"action",width:200,fixed:"right"}]),o=(0,V.iH)(),c=(0,V.qj)({customer_name:void 0,qty:void 0}),u={customer_name:[{required:!0,trigger:"change",message:"Nama customer tidak boleh kosong"}],qty:[{type:"number",required:!0,trigger:"change",message:"Berat barang tidak boleh kosong"}]};return{columns:r,setting:t,filterStatus:l,confirmDeliveryVisible:a,focusedTransaction:n,confirmDeliveryFormRef:o,confirmDeliveryFormState:c,confirmDeliveryRules:u,openConfirmDeliveryModal:s}},data(){return{rowData:[],loading:!0,loadingConfirm:!1}},computed:{filteredRowData(){return this.rowData.filter((e=>"all"===this.filterStatus||("wait"===this.filterStatus?1===e.status_id:"delivery"===this.filterStatus?2===e.status_id:"payment"===this.filterStatus?3===e.status_id:"done"===this.filterStatus?4===e.status_id:"canceled"!==this.filterStatus||5===e.status_id)))}},mounted(){this.fetchData()},methods:{async fetchData(){this.loading=!0;const e=await Y();e.success&&(this.rowData=e.data.data),this.loading=!1},refresh(){this.rowData=[],this.fetchData()},async doConfirmDelivery(){this.loadingConfirm=!0;const e=await G(this.focusedTransaction.id,{customer_name:this.confirmDeliveryFormState.customer_name,items_attributes:[{id:this.focusedTransaction.items[0].id,qty_after_delivery:this.confirmDeliveryFormState.qty}]});e.success&&(this.confirmDeliveryFormRef.resetFields(),this.confirmDeliveryVisible=!1,this.refresh()),this.loadingConfirm=!1},async doConfirmPayment(e){const t=await J(e.id);t.success&&this.refresh()},handleConfirmDelivery(){this.confirmDeliveryFormRef.validate().then((()=>this.doConfirmDelivery())).catch((()=>{}))},async doCancel(e){this.$nprogress.start();const t=await X(e);t.success&&this.refresh(),this.$nprogress.done()},handleCancel(e){this.$modal.confirm({title:"Konfirmasi",icon:()=>(0,i.Wm)(Z.Z),content:"Apakah Anda yakin untuk membatalkan transaksi ini?",onOk:()=>{this.doCancel(e)},onCancel:()=>{}})}}}),te=a(89);const ae=(0,te.Z)(ee,[["render",Q]]);var ie=ae}}]);